name: raw.product_variants
type: ingestr

description: Ingest OLTP product_variants from Postgres into DuckDB raw layer.

parameters:
  source_connection: pg-default
  source_table: "public.product_variants"
  destination: duckdb

columns:
  - name: id
    type: integer
    primary_key: true
    checks:
      - name: not_null
      - name: unique
      - name: positive
  - name: product_id
    type: integer
    checks:
      - name: not_null
      - name: positive
  - name: variant_sku
    type: string
    checks:
      - name: not_null
      - name: unique
  - name: color
    type: string
  - name: size
    type: string
  - name: manufacturing_price
    type: numeric
    checks:
      - name: not_null
      - name: range
        min: 0
  - name: selling_price
    type: numeric
    checks:
      - name: not_null
      - name: range
        min: 0
  - name: stock_quantity
    type: integer
    checks:
      - name: not_null
      - name: range
        min: 0
  - name: is_active
    type: boolean
    checks:
      - name: not_null
  - name: created_at
    type: timestamp
    checks:
      - name: not_null
  - name: updated_at
    type: timestamp
    checks:
      - name: not_null

custom_checks:
  - name: price sanity
    description: selling price should be >= manufacturing price
    query: |
      SELECT COUNT(*) FROM raw.product_variants WHERE selling_price < manufacturing_price
    value: 0
